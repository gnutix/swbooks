<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Star Wars Books</title>

    <link href="{{ asset(request, 'css/standard.css') }}" rel="stylesheet">
</head>
<body>
    <div id="global">
        <div id="content">
            <h1>Star Wars Books</h1>
            <p>
                This is the list of Star Wars books and comics with the main information about each of them.
                Featuring my possessions and my readings.
            </p>

            <h2>Books' editors</h2>
            <dl class="editors">
                {% for editor in library.editors %}
                    <dt>
                        <abbr title="{{ editor.name }}" lang="{{ editor.preferredLanguage }}">
                            {{ editor.id|upper }}
                        </abbr>
                    </dt>
                    <dd>{{ editor.name }}</dd>
                {% endfor %}
            </dl>

            <div class="spacer"></div>

            <h2>Books' types</h2>
            <ul class="legend">
                {% for category in library.categories %}
                    <li class="{{ category.id }}">{{ category.name }}</li>
                {% endfor %}
            </ul>

            <div class="spacer"></div>

            <h2>Shortcuts to the eras</h2>
            <ul class="shortcuts">
                {% for era in library.eras %}
                    <li class="{{ era.id }}"><a href="#{{ era.id }}">{{ era.name }}</a></li>
                {% endfor %}
            </ul>

            <h2>Books' list</h2>

            <div class="filtering">
                <h3>Filtering by language</h3>
                <div class="languages-container"></div>
            </div>

            <table class="books-list">
                <thead class="main-header">
                    <tr>
                        <th class="timeline">Timeline</th>
                        <th class="author">Author(s)</th>
                        <th class="title">Title</th>
                        <th><abbr title="Language of the release">Lang</abbr></th>
                        <th>Editor</th>
                        <th><abbr title="Format of the release">Format</abbr></th>
                        <th><abbr title="Number of copies owned">Nb.C</abbr></th>
                        <th><abbr title="Number of readings done">Nb.R</abbr></th>
                    </tr>
                </thead>

                {% for era in library.eras %}
                    <thead class="era-header">
                        <tr>
                            <th class="{{ era.id }}">
                                <a href="#{{ era.id }}" id="{{ era.id }}">{{ era.name }} era</a>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for book in library.books if book.chronologicalMarker.era.id == era.id %}
                            {% for release in book.releases %}
                                <tr lang="{{ release.language.id }}">
                                    <td>
                                        {{ book.chronologicalMarker.timeStart|starWarsDate|raw }}
                                        {% if book.chronologicalMarker.timeEnd is not empty %}
                                            {{ (' - '~ book.chronologicalMarker.timeEnd|starWarsDate)|raw }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        <ul class="inline-list">
                                            {% for author in book.authors %}
                                                <li>{{ author.name }}</li>
                                            {% endfor %}
                                        </ul>
                                    </td>
                                    <td class="book-title {{ book.category.id }}">
                                        {% if release.series is not empty and release.series.title is not empty %}
                                            {{ release.series.title -}}
                                            {% if release.series.bookId is not empty %}
                                                {{ ' '~ release.series.bookId -}}
                                            {% endif %}
                                            {{ ': ' }}
                                        {% endif %}
                                        {{ release.title }}

                                        {% if book.swuBookId is not empty %}
                                            {% set swuHost = 'http://www.starwars-universe.com/' %}
                                            <a href="{{ swuHost }}livre-{{ book.swuBookId }}-a.html">
                                                <img src="{{ swuHost }}favicon.ico" alt="Star Wars Universe website">
                                            </a>
                                        {% endif %}
                                    </td>
                                    <td class="textC">
                                        {% set flag = asset(request, 'images/flags/'~ release.language.id ~'.png', false) %}
                                        {% if flag is not empty %}
                                            <img src="{{ flag }}" alt="{{ release.language.name }}">
                                        {% else %}
                                            <abbr title="{{ release.language.name }}">{{ release.language.id|upper }}</abbr>
                                        {% endif %}
                                    </td>
                                    <td class="textC">
                                        <abbr title="{{ release.editor.name }}">{{ release.editor.id|upper }}</abbr>
                                    </td>
                                    <td class="textC">
                                        {% if release.format is not empty %}
                                            <abbr title="{{ release.format.name }}">{{ release.format.id|upper }}</abbr>
                                        {% endif %}
                                    </td>

                                    {% if release.published %}
                                        <td class="textC {{ release.owner.nbCopies == 0 ? 'red' : 'green' }}">
                                            {{ (release.owner.nbCopies > 1 ? release.owner.nbCopies : '')|raw }}
                                        </td>
                                        <td class="textC {{ release.owner.nbReadings == 0 ? 'red' : 'green' }}">
                                            {{ (release.owner.nbReadings > 1 ? release.owner.nbReadings : '')|raw }}
                                        </td>
                                    {% else %}
                                        <td colspan="2" class="textC publish">
                                            <abbr title="Expected publication date">
                                                {{ release.publicationDate|date('Y-m-d') }}
                                            </abbr>
                                        </td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        {% endfor %}
                    </tbody>
                {% endfor %}
            </table>
        </div>
    </div>

    <script src="{{ asset(request, 'components/jquery/jquery.min.js') }}"></script>
    <script src="{{ asset(request, 'components/paul-irish-jquery-unique-duck-punching/jquery-unique-function-duck-punching.js') }}"></script>
    <script src="{{ asset(request, 'components/brandon-aaron-jquery-outerhtml-function/jquery.outerhtml.js') }}"></script>
    <script src="{{ asset(request, 'components/edward-hotchkiss-wrapper/dist/wrapper-0.0.3.min.js') }}"></script>
    <script src="{{ asset(request, 'js/lib/object-swapper.js') }}"></script>
    <script src="{{ asset(request, 'js/books-table-manager.js') }}"></script>
    <script src="{{ asset(request, 'js/main.js') }}"></script>
</body>
</html>
